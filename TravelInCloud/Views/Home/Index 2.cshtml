@using TravelInCloud.Services
@model TravelInCloud.Models.HomeViewModels.IndexViewModel
@{
    ViewData["Title"] = "主页";
    bool Left = true;
}
@section css {
    <style>
        a img {
            width: 100%;
            height: 100%;
        }

        .obitabbar__icon {
            display: inline-block;
            width: 48px;
            height: 48px;
        }
    </style>
}

<div class="page searchbar js_show">
    <div class="page__bd">
        <div class="weui-search-bar" id="search_bar">
            <form class="weui-search-bar__form">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input class="weui-search-bar__input" id="search_input" required="" type="search" placeholder="搜索">
                </div>
                <label class="weui-search-bar__label" id="search_text" style="opacity: 1; transform: scale(1); transform-origin: 0px 0px 0px;" for="search_input">
                    <i class="weui-icon-search"></i>
                    <span>搜索</span>
                </label>

            </form>
            <a class="weui-search-bar__cancel-btn" id="search_cancel" href="javascript:">取消</a> &nbsp;
            <a class="weui-search-bar_focusing" id="switch" href="javascript:">修改地区</a>
        </div>
        <div class="weui-cells weui-cells_access search_show" id="search_show" style="display: none; opacity: 1; transform: scale(1); transform-origin: 0px 0px 0px; position:absolute; width:100%;z-index:1000;">
            <div class="weui-cell">
                <a class="weui-cell__bd weui-cell_primary" href="/Account/Login">
                    <p>实时搜索文本</p>
                </a>
            </div>
            <div class="weui-cell">
                <a class="weui-cell__bd weui-cell_primary">
                    <p>实时搜索文本</p>
                </a>
            </div>
            <div class="weui-cell">
                <a class="weui-cell__bd weui-cell_primary">
                    <p>实时搜索文本</p>
                </a>
            </div>
            <div class="weui-cell">
                <a class="weui-cell__bd weui-cell_primary">
                    <p>实时搜索文本</p>
                </a>
            </div>
        </div>
    </div>
    <div class="swiper-container home-slider" style="height:160px;">
        <ul class="swiper-wrapper">
            <li class="swiper-slide">
                <a href="javascript:;"><img src="~/images/pic_article.png" alt="" /></a>
            </li>
            <li class="swiper-slide">
                <a href="javascript:;"><img src="~/images/pic_article.png" alt="" /></a>
            </li>
            <li class="swiper-slide">
                <a href="javascript:;"><img src="~/images/pic_article.png" alt="" /></a>
            </li>
        </ul>
        <div class="swiper-pagination"></div>
    </div>
    <div class="weui-flex" style="background-color:white">
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="2">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/1.png">
                <p class="weui-tabbar__label">门票</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType ="12">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/2.png">
                <p class="weui-tabbar__label">租车</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="1">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/3.png">
                <p class="weui-tabbar__label">酒店</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="4">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/4.png">
                <p class="weui-tabbar__label">洗浴汗蒸</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="3">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/5.png">
                <p class="weui-tabbar__label">酒吧KTV</p>
            </a>
        </div>
    </div>
    <div class="weui-flex" style="background-color:white">
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="11">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/6.png">
                <p class="weui-tabbar__label">购物</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="10">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/8.png">
                <p class="weui-tabbar__label">美食</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/7.png">
                <p class="weui-tabbar__label">领金币</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="13">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/9.png">
                <p class="weui-tabbar__label">周边游</p>
            </a>
        </div>
        <div class="weui-flex__item">
            <a class="weui-tabbar__item weui-bar__item_on" asp-controller="Home" asp-action="ProductList" asp-route-StoreType="14">
                <img class="obitabbar__icon" alt="" src="~/images/10buttons/10.png">
                <p class="weui-tabbar__label">跟团游</p>
            </a>
        </div>
    </div>
    @*<div style="text-align:center;">
            <img style="width:100%;max-width:600px;" src="~/images/line.png">
        </div>*@


    <div class="weui-flex weui-form-preview">
        @for (int j = 1; j < 3; j++)
            {
            <div class="weui-flex__item">
                <div class="weui-panel__bd">
                    @for (int i = 1; i < 4; i++)
                    {
                        <a class="weui-media-box weui-media-box_appmsg" href="javascript:void(0);" style="padding:5px;">
                            <div class="weui-media-box__hd" style="width:40%;height:100%;max-width:200px;">
                                <img class="weui-media-box__thumb" alt="" src="~/images/6heads/h@(i * j).jpg">
                            </div>
                            <div class="weui-media-box__bd">
                                <h4 class="weui-media-box__title">大同刀削面</h4>
                                <p class="weui-media-box__desc">共199家，最低9元</p>
                            </div>
                        </a>
                    }
                </div>
            </div>
                <hr />
        }
    </div>

    @foreach (var Product in Model.Products)
    {
        <div class="weui-panel">
            <div class="weui-panel__bd">
                <a class="weui-media-box weui-media-box_appmsg" style="padding:0" asp-action="Product" asp-controller="Home" asp-route-id="@Product.ProductId">
                    @if (Left)
                    {
                        <div class="weui-media-box__hd" style="width:38.2%;max-width:300px;height:auto">
                            @if (Product.ImageOfProducts.Count > 0)
                            {
                                <img class="weui-media-box__thumb" alt="" src="@Product.ImageOfProducts[0]?.ImageSrc">
                            }
                        </div>
                    }
                    <div class="weui-media-box__bd" style="margin-left:10px;">
                        <h4 class="weui-media-box__title">@Product.ProductName</h4>
                        <p class="weui-media-box__desc">@Product.ProductDetails.OTake(100)</p>
                    </div>
                    @if (!Left)
                    {
                        <div class="weui-media-box__hd" style="width:38.2%;max-width:300px;height:auto">
                            @if (Product.ImageOfProducts.Count > 0)
                            {
                                <img class="weui-media-box__thumb" alt="" src="@Product.ImageOfProducts[0]?.ImageSrc">
                            }
                        </div>
                    }
                </a>
                <ul class="weui-media-box__info">
                    @if (Product.ProductTypes?.Count > 0)
                    {
                        <li class="weui-media-box__info__meta">@Product.ProductTypes.OrderBy(t => t.Price).First().Price</li>
                    }
                    <li class="weui-media-box__info__meta weui-media-box__info__meta_extra">已经售出：@Product.BuyTimes</li>
                </ul>
                @{
                    Left = !Left;
                }
            </div>
        </div>
                    }
</div>

@section Scripts {
    <script src="~/lib/Swiper/dist/js/swiper.min.js" type="text/javascript"></script>
    <script>
        var supportTouch = function () {
            try {
                document.createEvent("TouchEvent");
                return true;
            } catch (e) {
                return false;
            }
        }();
        var pageManager = {
            $container: $('#container'),
            _bind: function (page) {
                var events = page.events || {};
                for (var t in events) {
                    for (var type in events[t]) {
                        var that = this;
                        if (type == 'click' && supportTouch) {
                            (function (dom, event) {
                                var touchStartY;
                                that.$container.on('touchstart', dom, function (e) {
                                    touchStartY = e.changedTouches[0].clientY;
                                });
                                that.$container.on('touchend', dom, function (e) {
                                    if (Math.abs(e.changedTouches[0].clientY - touchStartY) > 10) return;
                                    e.preventDefault();

                                    events[dom][event].call(this, e);
                                });
                            })(t, type);
                        } else {
                            this.$container.on(type, t, events[t][type]);
                        }
                    }
                }
                page.isBind = true;
            }
        };
        var pages = {};
        pages.searchbar = {};
        pages.searchbar.events = {
            '#search_input': {
                focus: function () {
                    //searchBar
                    var $weuiSearchBar = $('#search_bar');
                    var $searchShow = $('#search_show');
                    $weuiSearchBar.addClass('weui-search-bar_focusing');
                    if ($(this).val()) {
                        $searchShow.show();
                    }
                },
                input: function () {
                    var $searchShow = $('#search_show');
                    if ($(this).val()) {
                        $searchShow.show();
                    } else {
                        $searchShow.hide();
                    }
                }
            },
            '#search_cancel': {
                click: function () {
                    $('#search_input').val('');
                    var $weuiSearchBar = $('#search_bar');
                    $weuiSearchBar.removeClass('weui-search-bar_focusing');
                    var $searchShow = $('#search_show');
                    $searchShow.hide();
                    $('#search_text').show();
                }
            }
        };
        pageManager._bind(pages.searchbar);
        var swiper = new Swiper('.swiper-container', {
            pagination: '.swiper-pagination',
            slidesPerView: 1,
            paginationClickable: true,
            spaceBetween: 0,
            loop: true,
        });
    </script>
}
